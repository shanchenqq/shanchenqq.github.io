import{K as k,_ as Z,r as p,D as ee,c as le,d as u,o as te,e as ae,f as l,w as t,h as n,B as R,g as f,k as P,L as V,p as oe,j as re}from"./index-9dd9b327.js";import{u as ne}from"./setting-82bf433b.js";const E={ALLROLE_URL:"/admin/acl/role/",ADDROLE_URL:"/admin/acl/role/save",UPDATEROLE_URL:"/admin/acl/role/update",ALLPERMISSTION:"/admin/acl/permission/toAssign/",SETPERMISTION_URL:"/admin/acl/permission/doAssign/?",REMOVEROLE_URL:"/admin/acl/role/remove/"},se=(r,s,g)=>k.get(E.ALLROLE_URL+`${r}/${s}/?roleName=${g}`),de=r=>r.id?k.put(E.UPDATEROLE_URL,r):k.post(E.ADDROLE_URL,r),ie=r=>k.get(E.ALLPERMISSTION+r),ue=(r,s)=>k.post(E.SETPERMISTION_URL+`roleId=${r}&permissionId=${s}`),ce=r=>k.delete(E.REMOVEROLE_URL+r);const pe=r=>(oe("data-v-4b938d6a"),r=r(),re(),r),me=pe(()=>P("h4",null,"分配菜单与按钮的权限",-1)),fe={style:{flex:"auto"}},_e={__name:"index",setup(r){let s=p(1),g=p(10),y=p(""),h=p(0),N=p([]);ee(()=>{L()});const L=async(o=1)=>{s.value=o;let e=await se(s.value,g.value,y.value);e.code==200&&(h.value=e.data.total,N.value=e.data.records)},T=()=>{L(),y.value=""};let x=ne();const D=()=>{x.refsh=!x.refsh};let m=p(!1),i=le({roleName:""});const M=()=>{var o;m.value=!0,Object.assign(i,{roleName:"",id:0}),(o=w.value)==null||o.clearValidate("roleName")},$=o=>{var e;m.value=!0,Object.assign(i,o),(e=w.value)==null||e.clearValidate("roleName")},q={roleName:[{required:!0,trigger:"blur",validator:(o,e,d)=>{e.trim().length>=2?d():d(new Error("职位名称至少两位"))}}]};let w=p();const j=async()=>{await w.value.validate(),(await de(i)).code==200&&(V({type:"success",message:i.id?"更新成功":"添加成功"}),m.value=!1,L(i.id?s.value:1))};let _=p(!1),C=p([]),O=p([]);const B=async o=>{_.value=!0,Object.assign(i,o);let e=await ie(i.id);e.code==200&&(C.value=e.data,O.value=S(C.value,[]))},K={children:"children",label:"name"},S=(o,e)=>(o.forEach(d=>{var v;d.select&&d.level==4&&e.push(d.id),((v=d.children)==null?void 0:v.length)>0&&S(d.children,e)}),e);let U=p();const H=async()=>{const o=i.id;let e=U.value.getCheckedKeys(),d=U.value.getHalfCheckedKeys(),v=e.concat(d);(await ue(o,v)).code==200&&(_.value=!1,V({type:"success",message:"分配权限成功"}),window.location.reload())},F=async o=>{(await ce(o)).code==200&&(V({type:"success",message:"删除成功"}),L(N.value.length>1?s.value:s.value-1))};return(o,e)=>{const d=u("el-input"),v=u("el-form-item"),c=u("el-button"),I=u("el-form"),z=u("el-card"),b=u("el-table-column"),G=u("el-popconfirm"),J=u("el-table"),Q=u("el-pagination"),W=u("el-dialog"),X=u("el-tree"),Y=u("el-drawer");return te(),ae("div",null,[l(z,null,{default:t(()=>[l(I,{inline:!0,class:"form"},{default:t(()=>[l(v,{label:"职位搜索"},{default:t(()=>[l(d,{placeholder:"请你输入职位关键字",modelValue:n(y),"onUpdate:modelValue":e[0]||(e[0]=a=>R(y)?y.value=a:y=a)},null,8,["modelValue"])]),_:1}),l(v,null,{default:t(()=>[l(c,{type:"primary",size:"default",disabled:!n(y),onClick:T},{default:t(()=>[f(" 搜索 ")]),_:1},8,["disabled"]),l(c,{type:"primary",size:"default",onClick:D},{default:t(()=>[f("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(z,{style:{margin:"10px 0"}},{default:t(()=>[l(c,{type:"primary",size:"default",icon:"Plus",onClick:M},{default:t(()=>[f(" 添加职位 ")]),_:1}),l(J,{border:"",style:{margin:"10px 0"},data:n(N)},{default:t(()=>[l(b,{type:"index",align:"center",label:"#"}),l(b,{label:"ID",align:"center",prop:"id"}),l(b,{label:"职位名称",align:"center","show-overflow-tooltip":"",prop:"roleName"}),l(b,{label:"创建时间",align:"center","show-overflow-tooltip":"",prop:"createTime"}),l(b,{label:"更新时间",align:"center","show-overflow-tooltip":"",prop:"updateTime"}),l(b,{label:"操作",width:"280px",align:"center"},{default:t(({row:a,$index:ge})=>[l(c,{type:"primary",size:"small",icon:"User",onClick:A=>B(a)},{default:t(()=>[f(" 分配权限 ")]),_:2},1032,["onClick"]),l(c,{type:"primary",size:"small",icon:"Edit",onClick:A=>$(a)},{default:t(()=>[f(" 编辑 ")]),_:2},1032,["onClick"]),l(G,{title:`你确定要删除${a.roleName}?`,width:"260px",onConfirm:A=>F(a.id)},{reference:t(()=>[l(c,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[f("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(Q,{"current-page":n(s),"onUpdate:currentPage":e[1]||(e[1]=a=>R(s)?s.value=a:s=a),"page-size":n(g),"onUpdate:pageSize":e[2]||(e[2]=a=>R(g)?g.value=a:g=a),"page-sizes":[10,20,30,40],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:n(h),onCurrentChange:L,onSizeChange:e[3]||(e[3]=a=>L())},null,8,["current-page","page-size","total"])]),_:1}),l(W,{modelValue:n(m),"onUpdate:modelValue":e[6]||(e[6]=a=>R(m)?m.value=a:m=a),title:n(i).id?"更新职位":"添加职位"},{footer:t(()=>[l(c,{type:"primary",size:"default",onClick:e[5]||(e[5]=a=>R(m)?m.value=!1:m=!1)},{default:t(()=>[f(" 取消 ")]),_:1}),l(c,{type:"primary",size:"default",onClick:j},{default:t(()=>[f("确定")]),_:1})]),default:t(()=>[l(I,{model:n(i),rules:q,ref_key:"form",ref:w},{default:t(()=>[l(v,{label:"职位名称",prop:"roleName"},{default:t(()=>[l(d,{placeholder:"请你输入职位名称",modelValue:n(i).roleName,"onUpdate:modelValue":e[4]||(e[4]=a=>n(i).roleName=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(Y,{modelValue:n(_),"onUpdate:modelValue":e[8]||(e[8]=a=>R(_)?_.value=a:_=a)},{header:t(()=>[me]),default:t(()=>[l(X,{data:n(C),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":n(O),props:K,ref_key:"tree",ref:U},null,8,["data","default-checked-keys"])]),footer:t(()=>[P("div",fe,[l(c,{onClick:e[7]||(e[7]=a=>R(_)?_.value=!1:_=!1)},{default:t(()=>[f("取消")]),_:1}),l(c,{type:"primary",onClick:H},{default:t(()=>[f("确定")]),_:1})])]),_:1},8,["modelValue"])])}}},Le=Z(_e,[["__scopeId","data-v-4b938d6a"]]);export{Le as default};
