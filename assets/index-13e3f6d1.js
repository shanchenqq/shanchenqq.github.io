import{K as w,_ as de,r as d,D as ie,c as me,d as p,o as x,e as B,f as l,w as t,h as r,B as L,g as m,k as A,t as F,q as M,m as pe,F as ce,n as fe,L as V,p as _e,j as ge}from"./index-9dd9b327.js";import{u as ve}from"./setting-82bf433b.js";const E={ALLUSER_URL:"/admin/acl/user/",ADDUSER_URL:"/admin/acl/user/save",UPDATEUSER_URL:"/admin/acl/user/update",ALLROLEURL:"/admin/acl/user/toAssign/",SETROLE_URL:"/admin/acl/user/doAssignRole",DELETEUSER_URL:"/admin/acl/user/remove/",DELETEALLUSER_URL:"/admin/acl/user/batchRemove"},Ue=(u,i,U)=>w.get(E.ALLUSER_URL+`${u}/${i}/?username=${U}`),ye=u=>u.id?w.put(E.UPDATEUSER_URL,u):w.post(E.ADDUSER_URL,u),Re=u=>w.get(E.ALLROLEURL+u),be=u=>w.post(E.SETROLE_URL,u),Le=u=>w.delete(E.DELETEUSER_URL+u),we=u=>w.delete(E.DELETEALLUSER_URL,{data:u});const Ee=u=>(_e("data-v-69461864"),u=u(),ge(),u),he={style:{flex:"auto"}},Ve=Ee(()=>A("h4",null,"分配角色(职位)",-1)),Ce={style:{flex:"auto"}},ke={__name:"index",setup(u){let i=d(1),U=d(5),I=d(0),C=d([]);ie(()=>{y()});const y=async(o=1,e=d(""))=>{i.value=o;let n=await Ue(i.value,U.value,e.value);n.code==200&&(I.value=n.data.total,C.value=n.data.records)};let f=d(!1),s=me({username:"",name:"",password:""});const H=()=>{var o;f.value=!0,Object.assign(s,{username:"",name:"",password:"",id:0}),(o=k.value)==null||o.clearValidate(["username","name","password"])},K=o=>{var e;f.value=!0,Object.assign(s,o),(e=k.value)==null||e.clearValidate(["username","name"])};let k=d();const G=async()=>{await k.value.validate();let o=await ye(s);console.log(o),o.code==200?(f.value=!1,V({type:"success",message:s.id?"更新成功":"添加成功"}),window.location.reload()):(f.value=!1,V({type:"error",message:s.id?"更新失败":"添加失败"}))},J=()=>{f.value=!1},Q={username:[{required:!0,trigger:"blur",validator:(o,e,n)=>{e.trim().length>=5?n():n(new Error("用户名字至少五位"))}}],name:[{required:!0,trigger:"blur",validator:(o,e,n)=>{e.trim().length>=5?n():n(new Error("用户昵称至少五位"))}}],password:[{required:!0,trigger:"blur",validator:(o,e,n)=>{e.trim().length>=6?n():n(new Error("用户密码至少六位"))}}]};let _=d(!1),h=d([]),g=d([]);const W=async o=>{Object.assign(s,o);let e=await Re(s.id);e.code==200&&(h.value=e.data.allRolesList,g.value=e.data.assignRoles,_.value=!0),S.value=g.value.length>0&&g.value.length<h.value.length},z=d(!1),S=d(!0),X=o=>{g.value=o?h.value:[],S.value=!1},Y=o=>{z.value=o.length===h.value.length,S.value=o.length>0&&o.length<h.value.length},Z=async()=>{let o={userId:s.id,roleIdList:g.value.map(n=>n.id)};(await be(o)).code==200&&(V({type:"success",message:"分配职务成功"}),_.value=!1,y(i.value))},ee=async o=>{(await Le(o)).code==200&&(V({type:"success",message:"删除成功"}),y(C.value.length>1?i.value:i.value-1))};let D=d([]);const le=o=>{D.value=o},ae=async()=>{let o=D.value.map(n=>n.id);(await we(o)).code==200&&(V({type:"success",message:"删除成功"}),y(C.value.length>1?i.value:i.value-1))};let R=d("");const te=()=>{y(1,R),R.value=""};let T=ve();const oe=()=>{T.refsh=!T.refsh};return(o,e)=>{const n=p("el-input"),b=p("el-form-item"),c=p("el-button"),q=p("el-form"),O=p("el-card"),v=p("el-table-column"),ne=p("el-popconfirm"),re=p("el-table"),se=p("el-pagination"),N=p("el-drawer"),P=p("el-checkbox"),ue=p("el-checkbox-group");return x(),B("div",null,[l(O,{style:{height:"80px"}},{default:t(()=>[l(q,{inline:!0,class:"form"},{default:t(()=>[l(b,{label:"用户名字:"},{default:t(()=>[l(n,{placeholder:"请你输入搜索用户名字",modelValue:r(R),"onUpdate:modelValue":e[0]||(e[0]=a=>L(R)?R.value=a:R=a)},null,8,["modelValue"])]),_:1}),l(b,null,{default:t(()=>[l(c,{type:"primary",size:"default",disabled:!r(R),onClick:te},{default:t(()=>[m(" 搜索 ")]),_:1},8,["disabled"]),l(c,{type:"primary",size:"default",onClick:oe},{default:t(()=>[m("重置")]),_:1})]),_:1})]),_:1})]),_:1}),l(O,{style:{margin:"10px 0"}},{default:t(()=>[l(c,{type:"primary",size:"default",onClick:H},{default:t(()=>[m("添加用户")]),_:1}),l(c,{type:"danger",size:"default",disabled:!r(D).length,onClick:ae},{default:t(()=>[m(" 批量删除 ")]),_:1},8,["disabled"]),l(re,{style:{margin:"10px 0"},border:"",data:r(C),onSelectionChange:le},{default:t(()=>[l(v,{type:"selection",align:"center"}),l(v,{label:"#",align:"center",type:"index"}),l(v,{label:"ID",align:"center",prop:"id"}),l(v,{label:"用户名字",align:"center",prop:"username","show-overflow-tooltip":""}),l(v,{label:"用户名称",align:"center",prop:"name","show-overflow-tooltip":""}),l(v,{label:"用户角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),l(v,{label:"创建时间",align:"center",prop:"createTime","show-overflow-tooltip":""}),l(v,{label:"更新时间",align:"center",prop:"updateTime","show-overflow-tooltip":""}),l(v,{label:"操作",width:"300px",align:"center"},{default:t(({row:a,$index:j})=>[l(c,{type:"primary",size:"small",icon:"User",onClick:$=>W(a)},{default:t(()=>[m(" 分配角色 ")]),_:2},1032,["onClick"]),l(c,{type:"primary",size:"small",icon:"Edit",onClick:$=>K(a)},{default:t(()=>[m(" 编辑 ")]),_:2},1032,["onClick"]),l(ne,{title:`你确定要删除${a.username}?`,width:"260px",onConfirm:$=>ee(a.id)},{reference:t(()=>[l(c,{type:"danger",size:"small",icon:"Delete"},{default:t(()=>[m("删除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(se,{"current-page":r(i),"onUpdate:currentPage":e[1]||(e[1]=a=>L(i)?i.value=a:i=a),"page-size":r(U),"onUpdate:pageSize":e[2]||(e[2]=a=>L(U)?U.value=a:U=a),"page-sizes":[5,7,9,11],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:r(I),onCurrentChange:y,onSizeChange:e[3]||(e[3]=a=>y())},null,8,["current-page","page-size","total"])]),_:1}),l(N,{modelValue:r(f),"onUpdate:modelValue":e[7]||(e[7]=a=>L(f)?f.value=a:f=a)},{header:t(()=>[A("h4",null,F(r(s).id?"更新用户":"添加用户"),1)]),default:t(()=>[l(q,{model:r(s),rules:Q,ref_key:"formRef",ref:k},{default:t(()=>[l(b,{label:"用户姓名",prop:"username"},{default:t(()=>[l(n,{placeholder:"请您输入搜索用户姓名",modelValue:r(s).username,"onUpdate:modelValue":e[4]||(e[4]=a=>r(s).username=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"用户昵称",prop:"name"},{default:t(()=>[l(n,{placeholder:"请您输入搜索用户昵称",modelValue:r(s).name,"onUpdate:modelValue":e[5]||(e[5]=a=>r(s).name=a)},null,8,["modelValue"])]),_:1}),r(s).id?pe("",!0):(x(),M(b,{key:0,label:"用户密码",prop:"password"},{default:t(()=>[l(n,{placeholder:"请您输入搜索用户密码",modelValue:r(s).password,"onUpdate:modelValue":e[6]||(e[6]=a=>r(s).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[A("div",he,[l(c,{onClick:J},{default:t(()=>[m("取消")]),_:1}),l(c,{type:"primary",onClick:G},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"]),l(N,{modelValue:r(_),"onUpdate:modelValue":e[12]||(e[12]=a=>L(_)?_.value=a:_=a)},{header:t(()=>[Ve]),default:t(()=>[l(q,null,{default:t(()=>[l(b,{label:"用户姓名"},{default:t(()=>[l(n,{modelValue:r(s).username,"onUpdate:modelValue":e[8]||(e[8]=a=>r(s).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),l(b,{label:"职位列表"},{default:t(()=>[l(P,{modelValue:z.value,"onUpdate:modelValue":e[9]||(e[9]=a=>z.value=a),indeterminate:S.value,onChange:X},{default:t(()=>[m(" 全选 ")]),_:1},8,["modelValue","indeterminate"]),l(ue,{modelValue:r(g),"onUpdate:modelValue":e[10]||(e[10]=a=>L(g)?g.value=a:g=a),onChange:Y},{default:t(()=>[(x(!0),B(ce,null,fe(r(h),(a,j)=>(x(),M(P,{key:j,label:a},{default:t(()=>[m(F(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[A("div",Ce,[l(c,{onClick:e[11]||(e[11]=a=>L(_)?_.value=!1:_=!1)},{default:t(()=>[m("取消")]),_:1}),l(c,{type:"primary",onClick:Z},{default:t(()=>[m("确定")]),_:1})])]),_:1},8,["modelValue"])])}}},qe=de(ke,[["__scopeId","data-v-69461864"]]);export{qe as default};
