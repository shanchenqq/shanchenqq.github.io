import{K as h,r as m,S as de,d as s,o as S,q as x,w as t,f as e,h as a,e as z,F as B,n as H,B as O,k as W,g as E,t as ie,L as P,c as pe,P as ce,O as me,x as _e,G as fe,z as Y,A as Z}from"./index-c2309140.js";const R={HASSPU_URL:"/admin/product/",ALLTRADEMARK_URL:"/admin/product/baseTrademark/getTrademarkList",IMAGE_URL:"/admin/product/spuImageList/",SPUHASSALEATTR_URL:"/admin/product/spuSaleAttrList/",ALLSALEATTR_URL:"/admin/product/baseSaleAttrList",ADDSPU_URL:"/admin/product/saveSpuInfo",UPDATESPU_URL:"/admin/product/updateSpuInfo",ADDSKU_URL:"/admin/product/saveSkuInfo",SKUINFO_URL:"/admin/product/findBySpuId/",REMOVESPU_URL:"/admin/product/deleteSpu/"},ge=(v,k,A)=>h.get(R.HASSPU_URL+`${v}/${k}?category3Id=${A}`),ee=()=>h.get(R.ALLTRADEMARK_URL),te=v=>h.get(R.IMAGE_URL+v),ae=v=>h.get(R.SPUHASSALEATTR_URL+v),le=()=>h.get(R.ALLSALEATTR_URL),Se=v=>v.id?h.post(R.UPDATESPU_URL,v):h.post(R.ADDSPU_URL,v),ve=v=>h.post(R.ADDSKU_URL,v),ye=v=>h.get(R.SKUINFO_URL+v),Ae=v=>h.delete(R.REMOVESPU_URL+v),Ue=["src"],be={__name:"spuForm",emits:["changeScene"],setup(v,{expose:k,emit:A}){const C=()=>{A("changeScene",{flag:0,params:"update"})};let U=m([]),b=m([]),V=m([]),r=m([]),y=m({category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]});const w=async l=>{let u=await ee();U.value=u.data;let o=await te(l.id);b.value=o.data.map(D=>({name:D.imgName,url:D.imgUrl}));let I=await ae(l.id);V.value=I.data;let M=await le();r.value=M.data,y.value=l};let N=m(!1),T=m("");const L=l=>{N.value=!0,T.value=l.url},p=()=>{console.log(123)},c=l=>l.type=="image/png"||l.type=="image/jpeg"||l.type=="image/gif"?l.size/1024/1024<3?!0:(P({type:"error",message:"上传文件务必小于3M"}),!1):(P({type:"error",message:"上传文件务必PNG|JPG|GIF"}),!1);let d=de(()=>r.value.filter(u=>V.value.every(o=>u.name!=o.saleAttrName))),_=m("");const $=()=>{const[l,u]=_.value.split(":");let o={baseSaleAttrId:l,saleAttrName:u,spuSaleAttrValueList:[]};V.value.push(o),_.value=""},f=l=>{l.flag=!0,l.saleAttrValue=""},i=l=>{const{baseSaleAttrId:u,saleAttrValue:o}=l;let I={baseSaleAttrId:u,saleAttrValueName:o};if(o.trim()==""){P({type:"error",message:"属性值不能为空的"});return}if(l.spuSaleAttrValueList.find(D=>D.saleAttrValueName==o)){P({type:"error",message:"属性值重复"});return}l.spuSaleAttrValueList.push(I),l.flag=!1},q=async()=>{y.value.spuImageList=b.value.map(u=>({imgName:u.name,imgUrl:u.response&&u.response.data||u.url})),y.value.spuSaleAttrList=V.value,(await Se(y.value)).code==200?(P({type:"success",message:y.value.id?"更新成功":"添加成功"}),A("changeScene",{flag:0,params:y.value.id?"update":"add"})):P({type:"error",message:y.value.id?"更新失败":"添加失败"})};return k({initHasSpuData:w,initAddSpu:async l=>{Object.assign(y.value,{category3Id:"",spuName:"",description:"",tmId:"",spuImageList:[],spuSaleAttrList:[]}),b.value=[],V.value=[],_.value="",y.value.category3Id=l;let u=await ee(),o=await le();U.value=u.data,r.value=o.data}}),(l,u)=>{const o=s("el-input"),I=s("el-form-item"),M=s("el-option"),D=s("el-select"),g=s("Plus"),X=s("el-icon"),G=s("el-upload"),ue=s("el-dialog"),j=s("el-button"),J=s("el-table-column"),ne=s("el-tag"),oe=s("el-table"),se=s("el-form");return S(),x(se,{"label-width":"100px"},{default:t(()=>[e(I,{label:"SPU名称"},{default:t(()=>[e(o,{placeholder:"请你输入SPU名称",modelValue:a(y).spuName,"onUpdate:modelValue":u[0]||(u[0]=n=>a(y).spuName=n)},null,8,["modelValue"])]),_:1}),e(I,{label:"SPU品牌"},{default:t(()=>[e(D,{modelValue:a(y).tmId,"onUpdate:modelValue":u[1]||(u[1]=n=>a(y).tmId=n)},{default:t(()=>[(S(!0),z(B,null,H(a(U),(n,Q)=>(S(),x(M,{key:n.id,label:n.tmName,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(I,{label:"SPU描述"},{default:t(()=>[e(o,{type:"textarea",placeholder:"请你输入SPU描述",modelValue:a(y).description,"onUpdate:modelValue":u[2]||(u[2]=n=>a(y).description=n)},null,8,["modelValue"])]),_:1}),e(I,{label:"SPU照片"},{default:t(()=>[e(G,{"file-list":a(b),"onUpdate:fileList":u[3]||(u[3]=n=>O(b)?b.value=n:b=n),action:"/api/admin/product/fileUpload","list-type":"picture-card","on-preview":L,"on-remove":p,"before-upload":c},{default:t(()=>[e(X,null,{default:t(()=>[e(g)]),_:1})]),_:1},8,["file-list"]),e(ue,{modelValue:a(N),"onUpdate:modelValue":u[4]||(u[4]=n=>O(N)?N.value=n:N=n)},{default:t(()=>[W("img",{"w-full":"",src:a(T),alt:"Preview Image",style:{width:"100%",height:"100%"}},null,8,Ue)]),_:1},8,["modelValue"])]),_:1}),e(I,{label:"SPU销售属性"},{default:t(()=>[e(D,{placeholder:a(d).length?`还未选择${a(d).length}个`:"无",modelValue:a(_),"onUpdate:modelValue":u[5]||(u[5]=n=>O(_)?_.value=n:_=n)},{default:t(()=>[(S(!0),z(B,null,H(a(d),(n,Q)=>(S(),x(M,{key:n.id,label:n.name,value:`${n.id}:${n.name}`},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]),e(j,{type:"primary",size:"default",icon:"Plus",style:{"margin-left":"10px"},disabled:!a(_),onClick:$},{default:t(()=>[E(" 添加属性 ")]),_:1},8,["disabled"]),e(oe,{border:"",style:{margin:"10px 0"},data:a(V)},{default:t(()=>[e(J,{label:"序号",type:"index",algin:"center",width:"80px"}),e(J,{label:"销售属性名字",width:"120px",prop:"saleAttrName"}),e(J,{label:"销售属性值"},{default:t(({row:n,$index:Q})=>[(S(!0),z(B,null,H(n.spuSaleAttrValueList,(F,re)=>(S(),x(ne,{key:n.id,class:"mx-1",closable:"",style:{margin:"0px 5px"},onClose:Le=>n.spuSaleAttrValueList.splice(re,1)},{default:t(()=>[E(ie(F.saleAttrValueName),1)]),_:2},1032,["onClose"]))),128)),n.flag==!0?(S(),x(o,{key:0,placeholder:"请你输入属性值",size:"small",style:{width:"100px"},modelValue:n.saleAttrValue,"onUpdate:modelValue":F=>n.saleAttrValue=F,onBlur:F=>i(n)},null,8,["modelValue","onUpdate:modelValue","onBlur"])):(S(),x(j,{key:1,type:"primary",size:"small",icon:"Plus",onClick:F=>f(n)},null,8,["onClick"]))]),_:1}),e(J,{label:"操作",width:"120px"},{default:t(({row:n,$index:Q})=>[e(j,{type:"primary",size:"small",icon:"Delete",onClick:F=>a(V).splice(Q,1)},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(I,null,{default:t(()=>[e(j,{type:"primary",size:"default",onClick:q,disabled:!(a(V).length>0)},{default:t(()=>[E(" 保存 ")]),_:1},8,["disabled"]),e(j,{type:"primary",size:"default",onClick:C},{default:t(()=>[E("取消")]),_:1})]),_:1})]),_:1})}}},Ve=["src"],ke={__name:"skuForm",emits:["changeScene"],setup(v,{expose:k,emit:A}){const C=()=>{A("changeScene",{flag:0,params:""})};let U=m([]),b=m([]),V=m([]),r=pe({category3Id:"",spuId:"",tmId:"",skuName:"",price:"",weight:"",skuDesc:"",skuAttrValueList:[],skuSaleAttrValueList:[],skuDefaultImg:""});k({initSkuData:async(L,p,c)=>{let d=await ce(L,p,c.category3Id),_=await ae(c.id),$=await te(c.id);U.value=d.data,b.value=_.data,V.value=$.data,r.category3Id=c.category3Id,r.spuId=c.id,r.tmId=c.tmId}});let w=m();const N=L=>{r.skuDefaultImg=L.imgUrl,V.value.forEach(p=>{w.value.toggleRowSelection(p,!1)}),w.value.toggleRowSelection(L,!0)},T=async()=>{r.skuAttrValueList=U.value.reduce((p,c)=>{if(c.attrIdAndValueId){let[d,_]=c.attrIdAndValueId.split(":");p.push({attrId:d,valueId:_})}return p},[]),r.skuSaleAttrValueList=b.value.reduce((p,c)=>{if(c.saleIdAndValueId){let[d,_]=c.saleIdAndValueId.split(":");p.push({saleAttrId:d,saleAttrValueId:_})}return p},[]),(await ve(r)).code==200?(P({type:"success",message:"添加SKU成功"}),A("changeScene",{flag:0,params:""})):P({type:"error",message:"添加SKU失败"})};return(L,p)=>{const c=s("el-input"),d=s("el-form-item"),_=s("el-option"),$=s("el-select"),f=s("el-form"),i=s("el-table-column"),q=s("el-button"),K=s("el-table");return S(),z("div",null,[e(f,{"label-width":"100px"},{default:t(()=>[e(d,{label:"SKU名称"},{default:t(()=>[e(c,{placeholder:"SKU名称",modelValue:a(r).skuName,"onUpdate:modelValue":p[0]||(p[0]=l=>a(r).skuName=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"价格(元)"},{default:t(()=>[e(c,{placeholder:"价格(元)",type:"number",modelValue:a(r).price,"onUpdate:modelValue":p[1]||(p[1]=l=>a(r).price=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"重量(克)"},{default:t(()=>[e(c,{placeholder:"重量(克)",type:"number",modelValue:a(r).weight,"onUpdate:modelValue":p[2]||(p[2]=l=>a(r).weight=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"SKU描述"},{default:t(()=>[e(c,{placeholder:"SKU描述",type:"textarea",modelValue:a(r).skuDesc,"onUpdate:modelValue":p[3]||(p[3]=l=>a(r).skuDesc=l)},null,8,["modelValue"])]),_:1}),e(d,{label:"平台属性"},{default:t(()=>[e(f,{inline:!0},{default:t(()=>[(S(!0),z(B,null,H(a(U),(l,u)=>(S(),x(d,{key:l.id,label:l.attrName},{default:t(()=>[e($,{modelValue:l.attrIdAndValueId,"onUpdate:modelValue":o=>l.attrIdAndValueId=o},{default:t(()=>[(S(!0),z(B,null,H(l.attrValueList,(o,I)=>(S(),x(_,{key:o.id,label:o.valueName,value:`${l.id}:${o.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(d,{label:"销售属性"},{default:t(()=>[e(f,{inline:!0},{default:t(()=>[(S(!0),z(B,null,H(a(b),(l,u)=>(S(),x(d,{key:l.id,label:l.saleAttrName},{default:t(()=>[e($,{modelValue:l.saleIdAndValueId,"onUpdate:modelValue":o=>l.saleIdAndValueId=o},{default:t(()=>[(S(!0),z(B,null,H(l.spuSaleAttrValueList,(o,I)=>(S(),x(_,{key:o.id,label:o.saleAttrValueName,value:`${l.id}:${o.id}`},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),e(d,{label:"图片名称"},{default:t(()=>[e(K,{border:"",data:a(V),ref_key:"table",ref:w},{default:t(()=>[e(i,{type:"selection",algin:"center",width:"80px"}),e(i,{label:"图片"},{default:t(({row:l,$index:u})=>[W("img",{src:l.imgUrl,alt:"",style:{width:"100px",height:"100px"}},null,8,Ve)]),_:1}),e(i,{label:"名称",prop:"imgName"}),e(i,{label:"操作"},{default:t(({row:l,$index:u})=>[e(q,{type:"primary",size:"small",onClick:o=>N(l)},{default:t(()=>[E(" 设置默认 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1}),e(d,null,{default:t(()=>[e(q,{type:"primary",size:"default",onClick:T},{default:t(()=>[E("保存")]),_:1}),e(q,{type:"primary",size:"default",onClick:C},{default:t(()=>[E("取消")]),_:1})]),_:1})]),_:1})])}}},Ie=["src"],Pe={__name:"index",setup(v){let k=m(0),A=m(1),C=m(3),U=me(),b=m([]),V=m(0);_e(()=>U.c3Id,()=>{b.value=[],U.c3Id&&r()});const r=async(f=1)=>{A.value=f;let i=await ge(A.value,C.value,U.c3Id);i.code==200&&(b.value=i.data.records,V.value=i.data.total)},y=()=>{k.value=1,w.value.initAddSpu(U.c3Id)};let w=m();const N=f=>{k.value=1,w.value.initHasSpuData(f)},T=f=>{k.value=f.flag,f.params=="update"?r(A.value):r()};let L=m();const p=f=>{k.value=2,L.value.initSkuData(U.c1Id,U.c2Id,f)};let c=m([]),d=m(!1);const _=async f=>{let i=await ye(f.id);i.code==200&&(c.value=i.data,d.value=!0)},$=async f=>{(await Ae(f.id)).code==200?(P({type:"success",message:"删除成功"}),r(b.value.length>1?A.value:A.value-1)):P({type:"error",message:"删除失败"})};return fe(()=>{U.$reset()}),(f,i)=>{const q=s("Category"),K=s("el-button"),l=s("el-table-column"),u=s("el-popconfirm"),o=s("el-table"),I=s("el-pagination"),M=s("el-dialog"),D=s("el-card");return S(),z("div",null,[e(q,{scene:a(k)},null,8,["scene"]),e(D,{style:{margin:"10px 0"}},{default:t(()=>[Y(W("div",null,[e(K,{type:"primary",size:"default",icon:"Plus",disabled:!a(U).c3Id,onClick:y},{default:t(()=>[E(" 添加SPU ")]),_:1},8,["disabled"]),e(o,{style:{margin:"10px 0"},border:"",data:a(b)},{default:t(()=>[e(l,{label:"序号",type:"index",algin:"center",width:"80px"}),e(l,{label:"SPU名称",prop:"spuName"}),e(l,{label:"SPU描述",prop:"description","show-overflow-tooltip":""}),e(l,{label:"SPU操作"},{default:t(({row:g,$index:X})=>[e(K,{type:"primary",size:"small",icon:"Plus",title:"添加SKU",onClick:G=>p(g)},null,8,["onClick"]),e(K,{type:"primary",size:"small",icon:"Edit",title:"修改SPU",onClick:G=>N(g)},null,8,["onClick"]),e(K,{type:"primary",size:"small",icon:"View",title:"查看SKU列表",onClick:G=>_(g)},null,8,["onClick"]),e(u,{title:`你确定删除${g.spuName}?`,width:"200px",onConfirm:G=>$(g)},{reference:t(()=>[e(K,{type:"primary",size:"small",icon:"Delete",title:"删除SPU"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(I,{"current-page":a(A),"onUpdate:currentPage":i[0]||(i[0]=g=>O(A)?A.value=g:A=g),"page-size":a(C),"onUpdate:pageSize":i[1]||(i[1]=g=>O(C)?C.value=g:C=g),"page-sizes":[3,5,7,9],background:!0,layout:"prev, pager, next, jumper, ->, sizes, total",total:a(V),onCurrentChange:r,onSizeChange:i[2]||(i[2]=g=>r())},null,8,["current-page","page-size","total"])],512),[[Z,a(k)==0]]),Y(e(be,{ref_key:"spu",ref:w,onChangeScene:T},null,512),[[Z,a(k)==1]]),Y(e(ke,{ref_key:"sku",ref:L,onChangeScene:T},null,512),[[Z,a(k)==2]]),e(M,{modelValue:a(d),"onUpdate:modelValue":i[3]||(i[3]=g=>O(d)?d.value=g:d=g),title:"SKU列表"},{default:t(()=>[e(o,{border:"",data:a(c)},{default:t(()=>[e(l,{label:"SKU名字",prop:"skuName"}),e(l,{label:"SKU价格",prop:"price"}),e(l,{label:"SKU重量",prop:"weight"}),e(l,{label:"SKU图片"},{default:t(({row:g,$index:X})=>[W("img",{src:g.skuDefaultImg,style:{width:"100px",height:"100px"}},null,8,Ie)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])}}};export{Pe as default};
