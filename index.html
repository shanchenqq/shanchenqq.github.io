<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copyright Â© 2003-2022 shan</title>
    <script src=" https://cdn.bootcdn.net/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/FileSaver.js/2.0.5/FileSaver.js"></script>
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/docxtemplater/3.31.2/docxtemplater.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip.js"></script>
    <script src="https://unpkg.com/pizzip@3.1.1/dist/pizzip-utils.js"></script>
    <style>
        /* https://juejin.cn/post/7172039729603412004 */
        /* html {
                filter: grayscale(1);
            } */

        .loading {
            position: absolute;
            top: 20px;
            left: 390px;

        }

        .loader {
            display: block;
            position: relative;
            height: 20px;
            width: 86px;
        }

        .loading-square {
            position: absolute;
            height: 20px;
            width: 20px;
            top: 0;
        }

        .loading-square:nth-child(1) {
            left: 0;
            animation: square1 1.5s linear forwards infinite;
        }

        .loading-square:nth-child(2) {
            left: 22px;
            animation: square2 1.5s linear forwards infinite;
        }

        .loading-square:nth-child(3) {
            left: 44px;
            animation: square3 1.5s linear forwards infinite;
        }

        .loading-square:nth-child(4) {
            left: 66px;
            animation: square4 1.5s linear forwards infinite;
        }

        @keyframes square1 {
            0% {
                background-color: #97c900;
                transform: translate(0, 0);
            }

            9.09091% {
                transform: translate(0, calc(-100% - 2px));
                background-color: #97c900;
            }

            18.18182% {
                transform: translate(calc(100% + 2px), calc(-100% - 2px));
                background-color: #15668a;
            }

            27.27273% {
                transform: translate(calc(100% + 2px), 0);
            }

            100% {
                background-color: #15668a;
                transform: translate(calc(100% + 2px), 0);
            }
        }

        @keyframes square2 {
            0% {
                background-color: #15668a;
                transform: translate(0, 0);
            }

            18.18182% {
                transform: translate(0, 0);
            }

            27.27273% {
                transform: translate(0, calc(100% + 2px));
                background-color: #15668a;
            }

            36.36364% {
                transform: translate(calc(100% + 2px), calc(100% + 2px));
                background-color: #D53A33;
            }

            45.45455% {
                transform: translate(calc(100% + 2px), 0);
            }

            100% {
                background-color: #D53A33;
                transform: translate(calc(100% + 2px), 0);
            }
        }

        @keyframes square3 {
            0% {
                background-color: #D53A33;
                transform: translate(0, 0);
            }

            36.36364% {
                transform: translate(0, 0);
            }

            45.45455% {
                transform: translate(0, calc(-100% - 2px));
                background-color: #D53A33;
            }

            54.54545% {
                transform: translate(calc(100% + 2px), calc(-100% - 2px));
                background-color: #E79C10;
            }

            63.63636% {
                transform: translate(calc(100% + 2px), 0);
            }

            100% {
                background-color: #E79C10;
                transform: translate(calc(100% + 2px), 0);
            }
        }

        @keyframes square4 {
            0% {
                transform: translate(0, 0);
                background-color: #E79C10;
            }

            54.54545% {
                transform: translate(0, 0);
            }

            63.63636% {
                transform: translate(0, calc(100% + 2px));
                background-color: #E79C10;
            }

            72.72727% {
                background-color: #D53A33;
            }

            81.81818% {
                background-color: #15668a;
            }

            90.90909% {
                transform: translate(calc(-300% - 6px), calc(100% + 2px));
                background-color: #97c900;
            }

            100% {
                transform: translate(calc(-300% - 6px), 0);
                background-color: #97c900;
            }
        }

        /* https://juejin.cn/post/7020064738956705823 */
        /* loading.css */
        .spinner {
            position: absolute;
            width: 128px;
            height: 128px;
            top: calc(50% - 64px);
            left: calc(50% - 64px);
            transform: perspective(206px) rotateX(45deg);
        }

        .outer {
            box-sizing: border-box;
            animation: spin 3s linear infinite;
            height: 100%;
        }

        .inner {
            position: absolute;
            border-radius: 50%;
            width: 64px;
            height: 64px;
            animation: spin 1.8s ease-in-out infinite;
        }

        .inner.tl {
            top: 0;
            left: 0;
            border-top: 2px solid #531430;
            border-left: 4px solid #531430;
        }

        .inner.tr {
            top: 0;
            right: 0;
            border-top: 2px solid #e04960;
            border-right: 4px solid #e04960;
        }

        .inner.br {
            bottom: 0;
            right: 0;
            border-bottom: 2px solid #531430;
            border-right: 4px solid #531430;
        }

        .inner.bl {
            bottom: 0;
            left: 0;
            border-bottom: 2px solid #e04960;
            border-left: 4px solid #e04960;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }


        .my_label {
            /* displayå±æ€§è§„å®šå…ƒç´ åº”è¯¥ç”Ÿæˆçš„æ¡†çš„ç±»å‹ inline-blockè¡Œå†…å—å…ƒç´  */
            display: inline-block;
            /* height å±æ€§è®¾ç½®å…ƒç´ çš„é«˜åº¦ */
            /* height: 38px; */
            /* line-height å±æ€§è®¾ç½®è¡Œé—´çš„è·ç¦» */
            line-height: 38px;
            /* å†…è¾¹è· */
            padding: 0 18px;
            /* èƒŒæ™¯é¢œè‰² */
            background-color: #009688;
            /* æ–‡æœ¬çš„é¢œè‰² */
            color: #fff;
            /* white-space å±æ€§è®¾ç½®å¦‚ä½•å¤„ç†å…ƒç´ å†…çš„ç©ºç™½ */
            /* nowrap æ–‡æœ¬ä¸ä¼šæ¢è¡Œï¼Œæ–‡æœ¬ä¼šåœ¨åœ¨åŒä¸€è¡Œä¸Šç»§ç»­ï¼Œç›´åˆ°é‡åˆ° <br> æ ‡ç­¾ä¸ºæ­¢ */
            white-space: nowrap;
            /* text-align å±æ€§è§„å®šå…ƒç´ ä¸­çš„æ–‡æœ¬çš„æ°´å¹³å¯¹é½æ–¹å¼ */
            text-align: center;
            font-size: 14px;
            /* border è¾¹æ¡†å±æ€§ å®½åº¦ æ ·å¼ é¢œè‰²*/
            border: medium double rgb(250, 0, 255);
            /* border-radius å±æ€§æ˜¯ä¸€ä¸ªç®€å†™å±æ€§ï¼Œç”¨äºè®¾ç½®å››ä¸ª border-*-radius å±æ€§ */
            border-radius: 2px;
            /* cursor å±æ€§è§„å®šè¦æ˜¾ç¤ºçš„å…‰æ ‡çš„ç±»å‹ï¼ˆå½¢çŠ¶ï¼‰ */
            cursor: pointer;
        }

        #droptarget {
            width: 200px;
            border: 6px yellow double;
            /* color: rgb(47, 61, 255); */
            /* line-height: 100px; */
            text-align: center;
            /* https://juejin.cn/post/7034323356459466760?share_token=6eaaa948-5b8b-4145-b7ca-3bb58442c9a4 */
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.12),
                0 2px 2px rgba(0, 0, 0, 0.12),
                0 4px 4px rgba(0, 0, 0, 0.12),
                0 8px 8px rgba(0, 0, 0, 0.12),
                0 16px 16px rgba(0, 0, 0, 0.12);
            background-color: blueviolet;
        }

        /* https://juejin.cn/post/7029468162462580750?share_token=20b36a97-9794-401f-b55d-cbf14e567920 */
        @import url('https://fonts.googleapis.com/css?family=Raleway:200');

        body {
            /* display: flex;
                justify-content: center;
                align-items: center; */
            /* height: 100%;
                background: #1D1F20;
                color: white; */
        }

        #box {
            display: flex;
            align-items: center;
            justify-content: center;
            /* å—é€šä¸­ä¸“å­¦ç”Ÿç»¼åˆç´ è´¨è¯„ä»·æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆå·¥å…·3.19.1ç‰ˆ */
            width: 376px;
            /* height: 26px; */
            font-family: 'Raleway';
        }

        .gradient-border {
            --borderWidth: 3px;
            background: #1D1F20;
            position: relative;
            border-radius: var(--borderWidth);
        }

        .gradient-border:after {
            content: '';
            position: absolute;
            top: calc(-1 * var(--borderWidth));
            left: calc(-1 * var(--borderWidth));
            height: calc(100% + var(--borderWidth) * 2);
            width: calc(100% + var(--borderWidth) * 2);
            background: linear-gradient(60deg, #f79533, #f37055, #ef4e7b, #a166ab, #5073b8, #1098ad, #07b39b, #6fba82);
            border-radius: calc(2 * var(--borderWidth));
            z-index: -1;
            animation: animatedgradient 3s ease alternate infinite;
            /* background-size: 100% 100%; */
        }

        @keyframes animatedgradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* https://juejin.cn/post/7086759520025706526?share_token=e4396797-3a26-4bdc-b0cb-aeb33daa6a4d */
        .card {
            color: rgba(255, 255, 255, 0.8);
            position: absolute;
            right: 100px;
            bottom: 100px;
            z-index: 10;
            font-family: sans-serif;
            /* text-align: center; */
            width: 300px;
            height: 500px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.4);
            border-left: 1px solid rgba(255, 255, 255, 0.4);
            background: linear-gradient(to top right,
                    rgba(90, 149, 207, 0.5),
                    rgba(58, 76, 99, 0.8));
            box-shadow: 10px -10px 20px rgba(0, 0, 0, 0.2),
                -10px 10px 20px rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(6px);
            border-radius: 20px;
            transform: rotate(-15deg);
        }

        h1 {
            margin-top: 10px;
        }

        h2 {
            margin-top: 40px;
        }

        h3,
        h4 {
            padding-left: 60px;
            text-align: left;
        }

        h3 {
            /* margin-top: 10px; */
            /* text-transform: uppercase; */
        }

        h4 {
            margin-top: -10px;
        }

        .circle {
            width: 160px;
            height: 160px;
            position: absolute;
            right: 240px;
            bottom: 30px;
            background: linear-gradient(to top left, rgb(135 116 249), rgb(75 162 237));
            border-radius: 80px;
        }

        .rect {
            width: 160px;
            height: 160px;
            position: absolute;
            right: 20px;
            bottom: 410px;
            background: linear-gradient(to top left,
                    rgba(135, 116, 249, 0.9),
                    rgba(75, 162, 237, 0.9));
            border-radius: 20px;
        }

        body {
            /* height: 100vh; */
            background: radial-gradient(circle at 60% 90%,
                    rgba(46, 103, 161, 1),
                    transparent 60%),
                radial-gradient(circle at 20px 20px,
                    rgba(46, 103, 161, 0.8),
                    transparent 25%),
                #182336;
            color: white;
        }

        /* https://juejin.cn/post/7026531307433754661 */
        .g-container {
            width: 225px;
            height: 25px;
            border-radius: 25px;
            background: #eee;
        }

        .g-progress {
            height: inherit;
            border-radius: 25px;
            background: linear-gradient(90deg, #0f0, #0ff 100%, transparent 0);
        }

        /* https://juejin.cn/post/7064404257436336135 */
        button {
            animation: tada 0s;
        }

        button:hover {
            animation-duration: 1s;
        }

        button:active {
            animation: none;
        }

        @keyframes tada {
            from {
                transform: scale3d(1, 1, 1)
            }

            10%,
            20% {
                transform: scale3d(.9, .9, .9) rotate3d(0, 0, 1, -3deg)
            }

            30%,
            50%,
            70%,
            90% {
                transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, 3deg)
            }

            40%,
            60%,
            80% {
                transform: scale3d(1.1, 1.1, 1.1) rotate3d(0, 0, 1, -3deg)
            }

            to {
                transform: scale3d(1, 1, 1)
            }
        }

        p {
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="loading">
        <div class="loading-square"></div>
        <div class="loading-square"></div>
        <div class="loading-square"></div>
        <div class="loading-square"></div>
    </div>

    <!-- https://juejin.cn/post/7020064738956705823 -->
    <div class="spinner">
        <div class="outer">
            <div class="inner tl"></div>
            <div class="inner tr"></div>
            <div class="inner br"></div>
            <div class="inner bl"></div>
        </div>
    </div>

    <div class="gradient-border" id="box">
        <p>å—é€šä¸­ä¸“å­¦ç”Ÿç»¼åˆç´ è´¨è¯„ä»·æŠ¥å‘Šè‡ªåŠ¨ç”Ÿæˆå·¥å…·3.19.3ç‰ˆ</p>
    </div>
    <p style="color:red;font-weight:bold;">ç¬¬ä¸€æ­¥: æ— éœ€æ‰‹åŠ¨æ•´åˆ,é€‰æ‹©ç›¸å…³Excelè¡¨æ ¼æ‰€åœ¨æ–‡ä»¶å¤¹ æˆ–è€… ç›´æ¥æ‹–å…¥ç›¸å…³Excelè¡¨æ ¼</p>
    <label id="realBtn" class="my_label">
        <!-- https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/Input/file#attr-accept -->
        <!-- https://juejin.cn/post/7063110398945280013 -->
        <input type="file" hidden multiple accept=".xlsx,.xls" webkitdirectory />
        ç‚¹å‡»é€‰å–æˆç»©è¡¨ã€å¾·è‚²å­¦åˆ†è¡¨ã€è¯„è¯­è¡¨(å¯é€‰)ã€è¿½åŠ è¡¨(å¯é€‰)æ‰€åœ¨çš„æ–‡ä»¶å¤¹
    </label>
    <div id="droptarget">
        <p>
            æ‹–å…¥æˆç»©è¡¨ã€<br>
            å¾·è‚²å­¦åˆ†è¡¨ã€<br>
            è¯„è¯­è¡¨(å¯é€‰)ã€<br>
            è¿½åŠ è¡¨(å¯é€‰)
        </p>
    </div>

    <div id="app">
        <p style="color:red;font-weight:bold;">ç¬¬äºŒæ­¥: è®¾ç½®å¿…è¦ä¿¡æ¯</p>
        <p>
            æ”¾å‡åŠå¼€å­¦æ—¶é—´:<br>
            <!-- https://blog.csdn.net/weixin_39784070/article/details/78456295 -->
            <!-- https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/textarea#attr-wrap -->
            <textarea type="text" placeholder="è¯·è¾“å…¥æ”¾å‡åŠå¼€å­¦æ—¶é—´" v-model="addInfo.start" rows="4" cols="34" style='resize: none;' warp='hard' disabled></textarea>
        </p>
        <p>
            ç»¼åˆç´ è´¨è¯„ä»·ç­‰çº§é»˜è®¤:
            --ä¼˜ç§€--æ‰“'âˆš'<input type="radio" v-model="pick" value="excellent" />
            --è‰¯å¥½--æ‰“'âˆš'<input type="radio" v-model="pick" value="good" />
        </p>

        <p style="color:red;font-weight:bold;">ç¬¬ä¸‰æ­¥: å…ˆç‚¹å‡»è·å–æ•´åˆæ•°æ®,å†ç‚¹å‡»å¼€å§‹åˆ¶ä½œ</p>

        <!-- <div id='show' style='visibility:hidden'> -->
        <div id='show' style='display:none'>
            <p v-if='isComments' style='color:green'>å½“å‰ä¸Šä¼ äº†è¯„è¯­è¡¨</p>
            <p v-else style='color:red'>å½“å‰æ²¡æœ‰ä¸Šä¼ è¯„è¯­è¡¨,è¯·è¾“å…¥ç­ä¸»ä»»å§“å: <input type='text' placeholder="ç­ä¸»ä»»å§“å" v-model="addInfo.teacher" style='width:85px' /></p>
        </div>

        <span style="color:white;font: 20px bold;" v-if="messages&&(n<=messages.length-1)">å½“å‰å®Œæˆè¿›åº¦: {{ n===-1 ? 0 : Math.floor(100*n/(messages.length-1)) }}%</span>
        <span style="color:yellowgreen;font: 20px bold;" v-if="messages&&(n>=messages.length-1)">
            å·²ç»å…¨éƒ¨å®Œæˆå•¦~~~~~~åšæŸå…‰ç…§äº®ä½ æ¸©æš–ä½ ~ä¸ºæ‚¨èŠ‚çœä¸‹æ¥çš„æ¯ä¸€ç§’éƒ½ä¼šä½¿æˆ‘å¿«ä¹!
        </span>
        <!-- è¿›åº¦æ¡ -->
        <div class="g-container"
            v-if="messages&&(n<=messages.length-1)">
            <div
                class="g-progress"
                :style="`width:${225*(n+1)/messages.length}px`">
            </div>
        </div>
        <p style="color:#0f0">{{info}}</p>
        <button @click="fetchMessages" class="my_label">è·å–æ•´åˆæ•°æ®</button>&nbsp
        <button @click="initiate" class="my_label">å¼€å§‹åˆ¶ä½œ</button>
    </div>

    <div class="card">
        <!-- <h1>å›å­æ…ç‹¬,ä¸æ¬ºæš—å®¤,å‘ä»¥è‡ªç‰§,å«ç« å¯è´.</h1>
        <h2>æ„: å³ä½¿åˆ«äººçœ‹ä¸è§ã€å¬ä¸è§ï¼Œä¹Ÿè¦è°¨æ…ä¸è‹Ÿï¼Œä¸åšè¿åé“å¾·æ³•å¾‹ä¹‹äº‹ï¼Œä¸è´Ÿè‰¯çŸ¥ï¼Œä¸æ¬ºå†…å¿ƒã€‚</h2>
        <h3>ã€Šç¤¼è®°ä¸­åº¸ã€‹</h3> -->
        <h2>ä½ è¦å†™åŒ†åŒ†,å°±ä¸èƒ½åªå†™åŒ†åŒ†,è¦å†™,æ°´é˜”å†™å±±é‡,å†™é£çµ®æµäº‘è¥¿å¤ä¸œ,å†™æ—¶å…‰æŒªç§»è¿‡æŒ‡ç¼,è¦å†™,é‡‘æ¨½å¯¹æœˆç©º,å†™æœæ¥å¯’é›¨æ™šæ¥é£,å†™å‡ å›é­‚æ¢¦ä¸å›åŒ,å†å†™,ä»Šå¹´èŠ±èƒœå»å¹´çº¢,é’ä¸å˜ç™½å‘,äººç”Ÿé•¿æ¨æ°´é•¿ä¸œï¼</h2>
        <h4>2022 / 07 / 31</h4>
    </div>
    <div class="circle"></div>
    <div class="rect"></div>

    <p style="color:gold">Copyright Â© 2003-2022 shanchen All Rights Reserved. ç‰ˆæœ¬å·:3.19.3</p>
</body>

<script>
    let isComments//åˆ¤æ–­æ˜¯å¦ä¸Šä¼ äº†è¯„è¯­è¡¨

    function handleFile(e) {
        // console.log(e.type)
        let files
        if (e.type === 'drop') {
            e.stopPropagation()
            //https://www.jianshu.com/p/6e921d7680ac
            //chromeæµè§ˆå™¨çš„dropäº‹ä»¶çš„é»˜è®¤è¡Œä¸ºæ˜¯æ‰“å¼€è¢«æ”¾åˆ°æ”¾ç½®ç›®æ ‡ä¸Šçš„URLã€‚ä¸ºäº†è®©chromeæ”¯æŒæ­£å¸¸çš„æ‹–æ”¾ï¼Œè¿˜è¦å–æ¶ˆdropäº‹ä»¶çš„é»˜è®¤è¡Œä¸º
            e.preventDefault()
            files = e.dataTransfer.files
        } else if (e.type === 'change') {
            files = e.target.files
        }
        // console.log(files)
        // debugger

        let file1, file2, file3, file4, file5, file6, file7
        for (let i = 0; i < files.length; i++) {
            const type = files[i].name.split('.')
            //æ ¡éªŒæ‹–å…¥æ–‡ä»¶æ˜¯å¦åˆæ³•
            // if (type.at(-1) !== 'xlsx' && type.at(-1) !== 'xls') {
            if (type[1] !== 'xlsx' && type[1] !== 'xls') {//å…¼å®¹360æµè§ˆå™¨
                alert('åªèƒ½é€‰æ‹©åç¼€åæ˜¯xlsxæˆ–è€…xlsçš„Excelæ–‡ä»¶æ‹–å…¥')
                return
            }
            //æŠŠæ•°æ®åˆ†ç±»ä¿å­˜
            if (type.at(0).includes('æˆç»©')) {
                file1 = files[i]
            } else if (type.at(0).includes('å­¦åˆ†')) {
                file2 = files[i]
            } else if (type.at(0).includes('è¯„è¯­')) {
                file3 = files[i]
            } else if (type.at(0).includes('è¿½åŠ ')) {
                file4 = files[i]
            } else if (type.at(0).includes('å­¦ç”Ÿ')) {//22Ã—Ã—ç­å­¦ç”Ÿä¿¡æ¯è¡¨
                file5 = files[i]//æ–°ç”Ÿæ±Ÿè‹çœå­¦ç±åº“ä¿¡æ¯å¯¼å…¥
            } else if (type.at(0).includes('è¡¥å……')) {
                file6 = files[i]//æ–°ç”Ÿæ±Ÿè‹çœå­¦ç±åº“ä¿¡æ¯å¯¼å…¥
            } else if (type.at(0).includes('ä¸“ä¸š')) {//2022çº§ç­çº§åŠä¸“ä¸šä¿¡æ¯è¡¨
                file7 = files[i]//æ–°ç”Ÿæ±Ÿè‹çœå­¦ç±åº“ä¿¡æ¯å¯¼å…¥
            }
        }
        // console.log(file7)
        // debugger
        // getExcelPlus(file7)
        //     .then(value => console.log(value))
        //     .catch(error => console.log(error))
        // debugger

        function getExcelPlus(file, unPlus = true) {
            return new Promise(function (resolve, reject) {
                const reader = new FileReader()
                //https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader/readAsBinaryString
                reader.readAsArrayBuffer(file)
                reader.onload = function (e) {
                    let fdata = e.target.result
                    fdata = new Uint8Array(fdata)

                    const workbook = XLSX.read(fdata, {type: 'array'})

                    const SheetNames = workbook.SheetNames
                    const worksheet = workbook.Sheets[SheetNames[0]]

                    //https://blog.csdn.net/weixin_43817709/article/details/103754546
                    const sheetOptions = {
                        /** Default value for null/undefined values */
                        defval: '', //ç»™defvalèµ‹å€¼ä¸ºç©ºçš„å­—ç¬¦ä¸²
                    }

                    const data = XLSX.utils.sheet_to_json(worksheet, sheetOptions)
                    if (unPlus) {
                        resolve(data)
                    } else {
                        //å¤„ç†æˆç»©file1
                        data.shift()
                        const headers = [
                            'å­¦ç”Ÿæˆç»©è¡¨',
                            '__EMPTY',
                            '__EMPTY_1',
                            '__EMPTY_2',
                            '__EMPTY_3',
                            '__EMPTY_4',
                            '__EMPTY_5',
                            '__EMPTY_6',
                            '__EMPTY_7',
                            '__EMPTY_8',
                            '__EMPTY_9',
                            '__EMPTY_10',//è¯¾ç¨‹æ€§è´¨
                            '__EMPTY_13',
                            '__EMPTY_15',
                            '__EMPTY_12',
                            '__EMPTY_11',//å­¦åˆ†
                        ]
                        //å°†dataä¸­çš„æ¯ä¸€é¡¹(å¯¹è±¡)æŒ‰headersçš„é¡ºåºè½¬å˜æˆæ•°ç»„
                        const aoa = data.map(obj => headers.map(head => obj[head]))
                        // console.log(aoa[0])
                        // console.log(aoa[0][8])//å­¦ç”Ÿå§“å
                        //åˆå¹¶å§“åç›¸åŒçš„å­¦ç”Ÿæˆç»©ä¿¡æ¯
                        const res = aoa.reduce((prev, next) => {
                            let index = prev.findIndex(elem => {
                                return next[8] === elem[8]
                            })
                            if (index === -1) {
                                return prev.concat([next])
                            } else {
                                prev[index] = prev[index].concat(next.slice(10))
                                return prev
                            }
                        }, [])
                        resolve(res)
                    }
                }
            })
        }

        if (file1 && file2) {//ä¸­èŒç­è¯„è¯­ä¸€å¹´ä¸€æ¬¡,é«˜èŒç­ä¸€å¹´ä¸¤æ¬¡
            const promise1 = getExcelPlus(file1, false)//æˆç»©
            const promise2 = getExcelPlus(file2)//å­¦åˆ†
            const promise3 = getExcelPlus(file3)//è¯„è¯­
            const promise4 = getExcelPlus(file4)//è¿½åŠ 
            Promise.allSettled([promise1, promise2, promise3, promise4]).then(v => {
                console.log(v)
                // console.log(v[3].status)//æœ‰è¿½åŠ è¿”å›'fulfilled' æ²¡æœ‰è¿½åŠ è¿”å›'rejected'
                // console.log(v[2].status)//æœ‰è¯„è¯­è¿”å›'fulfilled' æ²¡æœ‰è¯„è¯­è¿”å›'rejected'
                // debugger

                //tempç”¨æ¥æ”¶é›†æ‰€éœ€æ•°æ®
                const temp = []
                v[0].value.forEach((arr, index) => {
                    temp[index] = {å§“å: arr[8]}
                })
                // console.log(temp)
                // debugger
                //å¾·è‚²å­¦åˆ†è¡¨å–å¾·è‚²æ€»åˆ†å’Œæ“è¡Œç­‰ç¬¬æ•°æ®(å»ºè®®åœ¨å¾·è‚²å­¦åˆ†è¡¨çš„æ“è¡Œç­‰ç¬¬è¿™ä¸€åˆ—å³ä¾§å¢åŠ ä¸€åˆ—"èŒåŠ¡")
                temp.forEach(obj => {
                    v[1].value.forEach(obj2 => {
                        if (obj.å§“å === obj2.å§“å) {
                            obj.å¾·è‚²æ€»åˆ† = obj2.å¾·è‚²æ€»åˆ†
                            obj.æ“è¡Œç­‰ç¬¬ = obj2.æ“è¡Œç­‰ç¬¬
                            obj.èŒåŠ¡ = obj2.èŒåŠ¡
                        }
                    })
                })
                // console.log(temp)
                // debugger
                //è¯„è¯­è¡¨å–è¯„å®šè¯„è¯­å’Œç­ä¸»ä»»æ•°æ®
                if (v[2].status === 'fulfilled') {//å› ä¸ºå¯é€‰,æ‰€ä»¥åˆ¤æ–­
                    temp.forEach(obj => {
                        v[2].value.forEach(obj1 => {
                            if (obj.å§“å === obj1.å§“å) {
                                obj.è¯„å®šè¯„è¯­ = obj1.è¯„å®šè¯„è¯­
                                obj.ç­ä¸»ä»» = obj1.ç­ä¸»ä»»
                            }
                        })
                    })
                    isComments = true//æœ‰ä¸Šä¼ è¯„è¯­è¡¨
                } else {
                    isComments = false//æ²¡æœ‰ä¸Šä¼ è¯„è¯­è¡¨
                }
                // console.log(temp)
                // debugger
                //è¿½åŠ è¡¨å–éå­¦å·ã€å§“åã€ç­çº§çš„æ•°æ®
                if (v[3].status === 'fulfilled') {//å› ä¸ºå¯é€‰,æ‰€ä»¥åˆ¤æ–­
                    temp.forEach(obj => {
                        v[3].value.forEach(obj3 => {
                            if (obj.å§“å === obj3.å§“å) {
                                for (const key in obj3) {
                                    if (!['å­¦å·', 'å§“å', 'ç­çº§'].includes(key)) obj[key] = obj3[key]
                                }
                            }
                        })
                    })
                }
                // console.log(temp)
                // debugger

                //å°†tempæ±‡æ€»çš„æ•°æ®äº¤ç»™æˆç»©è¡¨
                v[0].value.forEach(arr => {
                    temp.forEach(obj => {
                        if (arr[8] === obj.å§“å) {
                            arr.splice(9, 0, obj)
                        }
                    })
                })
                // console.log(v[0].value[0])
                // debugger

                localStorage.setItem('messages', JSON.stringify(v[0].value))
            })
            return
        }

        if (file5 && file6 && file7) {
            const promise5 = getExcelPlus(file5)//å­¦ç”Ÿ
            const promise6 = getExcelPlus(file6)//è¡¥å……
            const promise7 = getExcelPlus(file7)//ä¸“ä¸š
            Promise.allSettled([promise5, promise6, promise7]).then(v => {
                // console.log(v)
                // console.log(v[0].status)//æœ‰è¿”å›'fulfilled' æ²¡æœ‰è¿½åŠ è¿”å›'rejected'
                // console.log(v[2].value)
                // debugger

                //æ•´åˆfile5ã€file6
                let data = v[0].value, data1 = v[1].value, data2 = v[2].value
                data.pop()//å»æ‰åˆè®¡è¿™ä¸€è¡Œ
                data1.shift()//å»æ‰æç¤ºè¿™ä¸€è¡Œ
                // console.log(data)
                // console.log(data1)
                // debugger

                data.forEach((obj0, index) => {
                    data1.forEach(obj1 => {
                        if (obj0.è€ƒç”Ÿå§“å === obj1.è€ƒç”Ÿå§“å) {
                            delete obj1.è€ƒç”Ÿå§“å
                            //forEachä¸‹ä¿®æ”¹åŸæ•°ç»„éœ€è¦ä½¿ç”¨data[index],è€Œä¸èƒ½æ˜¯obj0
                            data[index] = {...obj0, ...obj1}//data[index]=Object.assign(obj1)
                        }
                    })
                })
                // console.log(data)
                // debugger

                //æ ¹æ®ç­çº§åœ¨data2ä¸­é€‰å–ä¸“ä¸šåç§°
                // console.log(data[0].ç­çº§)
                const className = data[0].ç­çº§
                let professionalName
                data2.forEach(v => {
                    if (v.ç­çº§åç§° === className) professionalName = v.ä¸“ä¸šç®€ç§°
                })
                // console.log(professionalName)
                // debugger

                //æŒ‰æ–°ç”Ÿä¿¡æ¯å®Œå–„æ¨¡æ¿.xlsæ’åºæ•°æ®,äºŸå¾…æ ¸å¯¹é»˜è®¤å€¼è®¾å®š
                const aoa = data.map(obj => [
                    obj.è€ƒç”Ÿå§“å,
                    obj.æ€§åˆ«,
                    '',//å‡ºèº«æ—¥æœŸæ‰¹é‡è‡ªåŠ¨ç”Ÿæˆ
                    'å±…æ°‘èº«ä»½è¯',
                    obj.èº«ä»½è¯å·,
                    (obj.å­¦å· + '').slice(0, 4) + '09',//å…¥å­¦å¹´æœˆ202209
                    professionalName,//ä¸“ä¸šåç§° ä»2022çº§ç­çº§åŠä¸“ä¸šä¿¡æ¯è¡¨ä¸­è·å–
                    '',//ä¸“ä¸šæ–¹å‘å¯é€‰å¡«
                    'å­¦åˆ¶if8',//å­¦åˆ¶ ä»22å¹´æ‹›ç”Ÿå¤„è¡¨ä¸­çš„å­¦åˆ¶å¡«ä¸‰å¹´åˆ¶æˆ–äº”å¹´åˆ¶
                    '',//å§“åæ‹¼éŸ³æ‰¹é‡è‡ªåŠ¨ç”Ÿæˆ
                    'æ±‰æ—',//æ°‘æ—é»˜è®¤å€¼
                    'ä¸­å›½',//å›½ç±/åœ°åŒºé»˜è®¤å€¼
                    '',//æ¸¯æ¾³å°ä¾¨å¤–æ‰¹é‡è‡ªåŠ¨ç”Ÿæˆ
                    '',//å‡ºç”Ÿåœ°è¡Œæ”¿åŒºåˆ’ç æ‰¹é‡è‡ªåŠ¨ç”Ÿæˆ
                    '',//ç±è´¯åœ°è¡Œæ”¿åŒºåˆ’ç æ‰¹é‡è‡ªåŠ¨ç”Ÿæˆ
                    '',//æˆ·å£æ‰€åœ¨åœ°è¡Œæ”¿åŒºåˆ’ç æ‰¹é‡è‡ªåŠ¨ç”Ÿæˆ
                    obj.æˆ·å£æ€§è´¨,//éœ€é‡‡é›†
                    obj.æˆ·å£æ€§è´¨ === 'å†œä¸šæˆ·å£' ? 'å†œæ‘' : obj.å­¦ç”Ÿå±…ä½åœ°ç±»å‹,//éœ€é‡‡é›† å†œä¸šæˆ·å£å¯¹åº”å†œæ‘;éå†œä¸šæˆ·å£å¯¹åº”åŸå¸‚æˆ–ä¹¡é•‡éå†œ
                    obj.æˆ·å£æ‰€åœ¨åœ°åŒºå¿ä»¥ä¸‹è¯¦ç»†åœ°å€,//éœ€é‡‡é›†
                    obj.æ‰€å±æ´¾å‡ºæ‰€,//éœ€é‡‡é›†
                    obj.ä¹˜ç«è½¦åŒºé—´ || 'æ— ',//éœ€é‡‡é›†
                    obj.æ”¿æ²»é¢è²Œ,//éœ€é‡‡é›†
                    'æœªå©š',//å©šå§»çŠ¶å†µé»˜è®¤å€¼
                    obj.å¥åº·çŠ¶å†µ,//éœ€é‡‡é›†
                    obj.æ˜¯å¦å»ºæ¡£ç«‹å¡è´«å›°å®¶åº­,//éœ€é‡‡é›†
                    obj.è”ç³»ç”µè¯,//éœ€é‡‡é›†
                    'åº”å±Š',//å­¦ç”Ÿæ¥æºé»˜è®¤å€¼
                    'åº”å±Šåˆä¸­æ¯•ä¸šç”Ÿ',//æ‹›ç”Ÿå¯¹è±¡é»˜è®¤å€¼
                    'å¦',//æ¥è‡ªå†›é˜Ÿé»˜è®¤å€¼
                    'å¦',//æ˜¯å¦éšè¿å­å¥³é»˜è®¤å€¼
                    obj.æ¯•ä¸šå­¦æ ¡,//æ¯•ä¸šå­¦æ ¡
                    '',//ç”Ÿæºåœ°è¡Œæ”¿åŒºåˆ’ç æ‰¹é‡è‡ªåŠ¨ç”Ÿæˆ
                    'ç»Ÿä¸€æ‹›ç”Ÿ',//æ‹›ç”Ÿæ–¹å¼  éœ€è·Ÿå­¦ç”Ÿç¡®è®¤å¯èƒ½ä¸ºè‡ªä¸»æ‹›ç”Ÿ ä¸æ˜¯å‚åŠ å—é€šå¤§å¸‚ä¸­è€ƒçš„å°±æ˜¯å¤–åœ°ç”Ÿ,å¤–åœ°ç”Ÿé€‰è‡ªä¸»æ‹›ç”Ÿ,ä¸ç”¨å¡«è€ƒç”Ÿå·å’Œå‡†è€ƒè¯å·çš„
                    'æ³¨å†Œå…¥å­¦if33',//åªæœ‰ä¸‰å¹´ä¸­ä¸“å¡«æ˜¯,å…¶ä»–ä¸ºå¦
                    'ç»Ÿä¸€æ‹›ç”Ÿè€ƒè¯•/æ™®é€šå…¥å­¦',//å…¥å­¦æ–¹å¼
                    'æ˜¯',//æ˜¯å¦ä¸ºç¬¬ä¸€å¿—æ„¿
                    obj.å‡†è€ƒè¯å· || obj.è€ƒç”Ÿå·,//å‡†è€ƒè¯å· å¡«è€ƒç”Ÿå·
                    obj.è€ƒç”Ÿå·,//è€ƒç”Ÿå·
                    obj.åˆ†æ•°,//è€ƒè¯•æ€»åˆ†
                    '',//æ‹›ç”Ÿä¿¡æ¯é€‰å¡«é¡¹
                    '',//æ‹›ç”Ÿä¿¡æ¯é€‰å¡«é¡¹
                    '',//æ‹›ç”Ÿä¿¡æ¯é€‰å¡«é¡¹
                    '',//æ‹›ç”Ÿä¿¡æ¯é€‰å¡«é¡¹
                    obj.ç­çº§,//ç­çº§åç§°
                    obj.å­¦å·,//å­¦å·
                    'å­¦ç”Ÿç±»åˆ«if45',//å­¦ç”Ÿç±»åˆ«å¡«äº”å¹´åˆ¶é«˜èŒå­¦ç”Ÿæˆ–æ™®é€šä¸­ä¸“å­¦ç”Ÿ  5+2æœ¬ç§‘ç®—äº”å¹´åˆ¶é«˜èŒå­¦ç”Ÿ
                    'å…¨æ—¥åˆ¶',//å­¦ä¹ å½¢å¼é»˜è®¤å€¼
                    obj.æ˜¯å¦ä½å®¿ === 'å¦' ? 'èµ°è¯»' : 'ä½æ ¡',//å°±è¯»æ–¹å¼
                    'åˆ†æ®µåŸ¹å…»æ–¹å¼if48',
                    'å†…åœ°ä¸­èŒç­',//ä¸“é¡¹æ‹›ç”Ÿç±»å‹é»˜è®¤å€¼
                    'éè”åˆåŠå­¦',//è”æ‹›åˆä½œç±»å‹é»˜è®¤å€¼
                    '',//è”æ‹›åˆä½œå­¦ç”Ÿä¸ºå¿…å¡«
                    '',//è”æ‹›åˆä½œå­¦ç”Ÿä¸ºå¿…å¡«
                    '',//æ ¡å¤–æ•™å­¦ç‚¹çš„å­¦ç”Ÿä¸ºå¿…å¡«
                    '',//è‹±æ–‡å§“å
                    '',//ç”µå­é‚®ç®±/å…¶ä»–è”ç³»æ–¹å¼
                    obj.å®¶åº­ä½å€,//å®¶åº­ç°åœ°å€
                    '',//å®¶åº­é‚®æ”¿ç¼–ç 
                    '',//å®¶åº­ç”µè¯
                    obj.ç¬¬ä¸€ç›‘æŠ¤äººå§“å,//æˆå‘˜1å§“å
                    obj.ä¸ç¬¬ä¸€ç›‘æŠ¤äººå…³ç³»,//æˆå‘˜1å…³ç³»
                    'æ˜¯',//æˆå‘˜1æ˜¯å¦ç›‘æŠ¤äººé»˜è®¤å€¼
                    obj.ç¬¬ä¸€ç›‘æŠ¤äººè”ç³»ç”µè¯,//æˆå‘˜1è”ç³»ç”µè¯
                    '',
                    '',
                    '',
                    '',
                    '',
                    '',
                    '',
                    '',
                    obj.ç¬¬äºŒç›‘æŠ¤äººå§“å,//æˆå‘˜2å§“å
                    obj.ä¸ç¬¬äºŒç›‘æŠ¤äººå…³ç³»,//æˆå‘˜2å…³ç³»
                    'æ˜¯',//æˆå‘˜2æ˜¯å¦ç›‘æŠ¤äººé»˜è®¤å€¼
                    obj.ç¬¬äºŒç›‘æŠ¤äººè”ç³»ç”µè¯,//æˆå‘˜2è”ç³»ç”µè¯
                ])

                //å¤„ç†å­¦åˆ¶if8ã€å­¦ç”Ÿç±»åˆ«if45ã€åˆ†æ®µåŸ¹å…»æ–¹å¼if48ã€æ³¨å†Œå…¥å­¦if33
                for (const [key, obj] of data.entries()) {
                    let arr = aoa[key]
                    //22å¹´æ‹›ç”Ÿå¤„è¡¨ä¸­çš„å­¦åˆ¶çš„å€¼æœ‰äº”ç§:3+3ä¸“ç§‘ã€3+4æœ¬ç§‘ã€5+2æœ¬ç§‘ã€ä¸‰å¹´ä¸­ä¸“ã€äº”å¹´åˆ¶é«˜èŒ
                    //å­¦åˆ¶if8ã€å­¦ç”Ÿç±»åˆ«if45
                    if (['ä¸‰å¹´ä¸­ä¸“', '3+3ä¸“ç§‘', '3+4æœ¬ç§‘'].includes(obj.å­¦åˆ¶)) {
                        arr[8] = 'ä¸‰å¹´åˆ¶'
                        arr[45] = 'æ™®é€šä¸­ä¸“å­¦ç”Ÿ'
                    } else if (['äº”å¹´åˆ¶é«˜èŒ', '5+2æœ¬ç§‘'].includes(obj.å­¦åˆ¶)) {
                        arr[8] = 'äº”å¹´åˆ¶'//å­¦åˆ¶if8
                        arr[45] = 'äº”å¹´åˆ¶é«˜èŒå­¦ç”Ÿ'//å­¦ç”Ÿç±»åˆ«if45
                    }
                    //åˆ†æ®µåŸ¹å…»æ–¹å¼if48
                    arr[48] =
                        obj.å­¦åˆ¶ === 'ä¸‰å¹´ä¸­ä¸“'
                            ? 'éåˆ†æ®µåŸ¹å…»'
                            : obj.å­¦åˆ¶ === '3+3ä¸“ç§‘'
                                ? 'ä¸­é«˜èŒ3+3(å«å«ç”Ÿç±»4+2)'
                                : obj.å­¦åˆ¶ === '3+4æœ¬ç§‘'
                                    ? 'ä¸­èŒæœ¬ç§‘3+4'
                                    : ['äº”å¹´åˆ¶é«˜èŒ', '5+2æœ¬ç§‘'].includes(obj.å­¦åˆ¶)
                                        ? 'äº”å¹´ä¸€è´¯åˆ¶' : ''

                    //æ³¨å†Œå…¥å­¦if33
                    arr[33] = obj.å­¦åˆ¶ === 'ä¸‰å¹´ä¸­ä¸“' ? 'æ˜¯' : 'å¦'
                }

                //æµ‹è¯•
                // console.log(aoa[0])
                // console.log(aoa[0][8])//å­¦åˆ¶
                // console.log(aoa[0][43])//ç­çº§
                // console.log(aoa[0][44])//å­¦å·
                // console.log(aoa[0][45])//å­¦ç”Ÿç±»åˆ«
                // console.log(aoa[0][47])//å°±è¯»æ–¹å¼
                // console.log(aoa[0][48])//åˆ†æ®µåŸ¹å…»æ–¹å¼
                // debugger

                //è¾“å‡ºæ•´ç†å¥½çš„æ•°æ®Excel
                function exportExcel(aoa) {
                    //åˆ›å»ºworksheet
                    const ws = XLSX.utils.aoa_to_sheet(aoa)
                    //è®¾ç½®æ¯åˆ—çš„åˆ—å®½ï¼Œ10ä»£è¡¨10ä¸ªå­—ç¬¦ï¼Œæ³¨æ„ä¸­æ–‡å 2ä¸ªå­—ç¬¦
                    // ws['!cols'] = [
                    //     { wch: 10 },
                    //     { wch: 30 },
                    //     { wch: 25 },
                    // ]
                    //åˆ›å»ºworkbook
                    const wb = XLSX.utils.book_new()
                    //ç”Ÿæˆxlsxæ–‡ä»¶(book,sheetæ•°æ®,sheetå‘½å)
                    XLSX.utils.book_append_sheet(wb, ws, 'åˆ—è¡¨è¯¦æƒ…')
                    //å†™æ–‡ä»¶(workbook,xlsxæ–‡ä»¶åç§°)
                    //å·¥ä½œç°¿æ–‡ä»¶å±æ€§Props
                    XLSX.writeFile(wb, `${aoa[0][43].slice(0, 4)}è¾…åŠ©è¡¨.xlsx`, {
                        Props: {
                            Author: 'tpircsavaj',
                            Title: 'æ‰›å¾—ä½æ¶…æ§ƒä¹‹ç—›,',
                            Subject: 'æ‰é…å¾—ä¸Šé‡ç”Ÿä¹‹ç¾',
                            Keywords: 'ä½ èµ°çš„æ¯ä¸€æ­¥éƒ½ç®—æ•°,',
                            Category: 'éƒ½æ˜¯è®©ä½ å¼€æ‚Ÿçš„è‰¯è¯',
                            Comments: 'ä½ èƒ½å‘ç°è¿™é‡Œçš„å½©è›‹å˜›~',
                        },
                    })
                }
                exportExcel(aoa)
            })
            return
        }

        if (!(file1 && file2) || !(file5 && file6 && file7)) {
            alert(`
                å¦‚æœæ‚¨æƒ³åˆ¶ä½œç´ è´¨æŠ¥å‘Šå•è¯·ä¸Šä¼ å¿…éœ€çš„æˆç»©è¡¨ã€å¾·è‚²å­¦åˆ†è¡¨ã€<è¯„è¯­è¡¨(å¯é€‰)ã€è¿½åŠ è¡¨(å¯é€‰)>!!!
                å¦‚æœæ‚¨åˆ¶ä½œæ–°ç”Ÿæ±Ÿè‹çœå­¦ç±åº“ä¿¡æ¯å¯¼å…¥è¯·ä¸Šä¼ å¿…éœ€çš„å­¦ç”Ÿä¿¡æ¯è¡¨ã€è¡¥å……ä¿¡æ¯è¡¨~~~`)
            return
        }
    }

    //æµè§ˆå™¨é€šè¿‡formå…ƒç´ ä¸Šä¼ æ–‡ä»¶
    realBtn.addEventListener('change', handleFile, false)

    //æµè§ˆå™¨æ‹–æ‹½
    //é«˜çº§ç¨‹åºè®¾è®¡ç¬¬4ç‰ˆ 20.6.2 è‡ªå®šä¹‰æ”¾ç½®ç›®æ ‡ 20.4.6è¯»å–æ‹–æ”¾æ–‡ä»¶
    // let droptarget = document.getElementById('droptarget')
    document.documentElement.addEventListener('dragenter', event => {
        event.preventDefault()
    })
    document.documentElement.addEventListener('dragover', event => {
        event.preventDefault()
    })
    document.documentElement.addEventListener('drop', handleFile, false)

</script>

<script>
    const app = Vue.createApp({
        data() {
            return {
                //æ•´åˆæ•°æ®
                messages: JSON.parse(localStorage.getItem('messages')),
                n: -1,//ç”¨æ¥è¡¨ç¤ºmessagesç´¢å¼•
                keys: ['course', 'nature', 'mid', 'end', 'semester', 'credit'],
                timer: 0,//è¿›åº¦æ¡
                pick: 'good',//å•é€‰æ¡†å†³å®šaddInfo.eçš„å–å€¼
                //é¢å¤–æ•°æ®
                addInfo: {
                    start: 'æ ¹æ®å—é€šå¸‚æ•™è‚²å±€é€šçŸ¥ç²¾ç¥ï¼Œæˆ‘æ ¡å†³å®šäº2022å¹´6æœˆ26æ—¥è‡³2022å¹´9æœˆ11æ—¥æ”¾å‡ï¼Œä¸‹å­¦æœŸäº2022å¹´9æœˆ12æ—¥æŠ¥åˆ°æ³¨å†Œã€‚',
                    e: '',
                    g: '',
                    teacher: '',
                },
                isComments: false,
                info: 'ğŸ‘‡ğŸ»å…ˆç‚¹å‡»è·å–æ•´åˆæ•°æ®,å†ç‚¹å‡»å¼€å§‹åˆ¶ä½œ',//è·å–æ•´åˆæ•°æ®æŒ‰é’®çš„äº¤äº’
            }
        },
        methods: {
            //è·å–æ•´åˆæ•°æ®messages
            fetchMessages() {
                this.messages = JSON.parse(localStorage.getItem('messages'))
                console.log(this.messages)

                this.isComments = isComments
                console.log(this.isComments)
                // show.style.visibility = 'visible'
                show.style.display = 'block'

                this.info = this.messages ? 'è·å–æ•´åˆæ•°æ®æˆåŠŸ~' : 'è·å–æ•´åˆæ•°æ®å¤±è´¥,è¯·å›åˆ°ç¬¬ä¸€æ­¥é€‰å–æˆ–è€…æ‹–å…¥ç›¸å…³Excelè¡¨'
            },

            //å¼€å…³
            initiate() {
                if (!this.messages) {
                    alert(`è¯·å…ˆè·å–æ•´åˆæ•°æ®`)
                    return
                }
                this.timer = setInterval(() => {
                    if (this.n <= this.messages.length - 1) this.n++
                    else clearInterval(this.timer)//this.nç­‰äºthis.messages.length-1æ—¶æœ€åä¸€æ¬¡è‡ªå¢
                }, 200)
            },

            loadFile(url, callback) {
                //chromeæµè§ˆå™¨è®¾ç½®è·¨åŸŸ
                //https://blog.csdn.net/oscar999/article/details/124114343
                // --allow-file-access-from-files
                //edgeæµè§ˆå™¨è®¾ç½®è·¨åŸŸ(chromeä¹Ÿé€‚ç”¨)
                //https://juejin.cn/post/7114185715893665800?share_token=7e800f94-c6b9-4bdd-b831-d29768d64726
                // --args --disable-web-security --user-data-dir=E:\Cache
                // --disable-web-security --user-data-dir=E:\Cache
                //å…ˆæ‰“å¼€è®¾ç½®å¥½è·¨åŸŸçš„æµè§ˆå™¨å¿«æ·æ–¹å¼,å†æŠŠhtmlæ‹–è¿›å»
                //ç«ç‹æµè§ˆå™¨è®¾ç½®è·¨åŸŸ
                //https://blog.csdn.net/qq_43592064/article/details/118903001
                PizZipUtils.getBinaryContent(url, callback)
            },
            generate(msg, rec, add) {
                let str = this.isComments ? "high.docx" : "low.docx"
                this.loadFile(str, function (error, content) {
                    //æŠ›å‡ºè¯»å–é”™è¯¯
                    if (error) {throw error}

                    var zip = new PizZip(content)
                    //https://docxtemplater.com/docs/configuration/#paragraphloop
                    //https://docxtemplater.com/docs/configuration/#linebreaks
                    var doc = new docxtemplater(zip, {
                        paragraphLoop: true,
                        linebreaks: true,
                        //https://juejin.cn/post/7094139413248081928
                        nullGetter: function () {
                            return ""
                        }
                    })

                    //è¦å¡«å……çš„æ•°æ®
                    doc.setData({
                        ...rec,//æˆç»©
                        ...add,//é¢å¤–æ•°æ®

                        ...msg[9],//
                        // comments: msg[9].è¯„å®šè¯„è¯­,
                        // moral: msg[9].å¾·è‚²æ€»åˆ†,
                        // conduct: msg[9].æ“è¡Œç­‰ç¬¬,
                        // position: msg[9].èŒåŠ¡,
                        // teacher: msg[9].ç­ä¸»ä»»,
                        //ä»æˆç»©è¡¨ä¸­è·å–ä»¥ä¸‹5é¡¹æ•°æ®,å› ä¸ºè¯„è¯­è¡¨(åŒ…å«ä»¥ä¸‹5é¡¹æ•°æ®)å¯èƒ½ä¸ä¸Šä¼ ,æ‰€ä»¥ä»msg[9]ä¸­è·å–ä»¥ä¸‹æ•°æ®ä¼šäº§ç”Ÿé—®é¢˜
                        time: msg[0],//msg[9].å­¦å¹´
                        num: msg[1],//msg[9].å­¦æœŸ
                        class: msg[5],//msg[9].ç­çº§
                        name: msg[8],//msg[9].å§“å//å­¦åˆ†è¡¨ä¸­å«æœ‰çš„
                        id: msg[7],//msg[9].å­¦å·//å­¦åˆ†è¡¨ä¸­å«æœ‰çš„

                        department: msg[2],//ä»æˆç»©è¡¨ä¸­è·å–ç³»éƒ¨
                    })
                    try {
                        doc.render()
                    }
                    catch (error) {
                        //https://docxtemplater.com/docs/errors/#handling-multiple-errors
                        //https://juejin.cn/post/7026337152044630047
                        let e = {
                            message: error.message,
                            name: error.name,
                            stack: error.stack,
                            properties: error.properties
                        };
                        console.log(JSON.stringify({error: e}))
                        throw error
                    }

                    var out = doc.getZip().generate({
                        type: "blob",
                        mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                        //https://docxtemplater.com/docs/faq/#generate-smaller-docx-using-compression
                        compression: "DEFLATE",
                    })

                    //https://www.hangge.com/blog/cache/detail_1795.html
                    //éœ€è¦è‡ªå·±è®¾ç½®å¥½æµè§ˆå™¨ä¿å­˜æ–‡ä»¶çš„ä½ç½®
                    saveAs(out, `${msg[5]} ${msg[7]} ${msg[8]}.docx`)
                })
            },
        },
        watch: {
            n(newValue) {
                // if (!this.messages) {
                // alert(`è¯·å…ˆè·å–æ•°æ®`)
                // return
                // }
                if (this.n === this.messages.length) {
                    alert(`ä¸ºæ‚¨èŠ‚çœä¸‹æ¥çš„æ¯ä¸€ç§’éƒ½ä¼šä½¿æˆ‘å¿«ä¹!`)
                    return
                }

                const message = this.messages[newValue]
                const record = {}
                for (let j = 11; j <= 16; j++) {
                    for (let i = 1; i <= 12; i++) {
                        record[this.keys[j - 11] + i] = message[j + (i - 1) * 6]
                    }
                }
                this.generate(message, record, this.addInfo)
            },

            // addInfo: {
            //     handler: function (newValue, oldValue) {
            //         // console.log(newValue, oldValue)
            //         newValue.e === 'âˆš' ? newValue.g = '' : newValue.g = 'âˆš'
            //     },
            //     deep: true
            // }
            pick: {
                handler: function (newValue, oldValue) {
                    // console.log(this.pick)
                    [this.addInfo.g, this.addInfo.e] = newValue === 'good' ? ['âˆš', ''] : ['', 'âˆš']
                    // console.log([this.addInfo.g, this.addInfo.e])
                },
                immediate: true,
            }
        }
    })

    const vm = app.mount('#app')
</script>

</html>